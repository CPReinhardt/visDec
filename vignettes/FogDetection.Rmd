---
title: "Fog Detection"
author: "Martin"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Fog Detection}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


## Image application
```{r, fig.show='hold'}
library(ggplot2)
library(foreach)
library(itertools)
library(data.table)
library(visDec)
library(imager)
filenames <- list.files("../inst/extdata/Meetterrein/", pattern=".jpg", full.names=TRUE)
imageSummary <- lapply(filenames, ExtractBasicImageStatistics)
imageSummary <- rbindlist(imageSummary)
ggplot(imageSummary, aes(x = datetime, y = mean)) + geom_line()
ggplot(imageSummary, aes(x = datetime, y = var)) + geom_line()
ggplot(imageSummary, aes(x = datetime, y = sqrt(var)/mean)) + geom_line()
#ggplot(imageSummary[datetime > "2015-10-09" & datetime <= "2015-10-10"], aes(x = datetime, y = mean)) + geom_line()
```

```{r, fig.show='hold'}
sensor <- data.table(read.table("../inst/extdata/Sensor/MOR_DeBilt_201510.txt", header=TRUE))
fn <- function(x) {
  if (x < 10000) paste("00", x, sep="")
  else if (x < 100000) paste("0", x, sep="")
  else paste(x)
}
newTime <- sensor[, fn(hhmmss), by = .(yyyymmhh, hhmmss)]$V1
sensor[, hhmmss := newTime]
newDateTime <- as.POSIXct(sensor[, paste(yyyymmhh, hhmmss)], format="%Y%m%d %H%M%S")
sensor[, dateTime := newDateTime]
sensor[, yyyymmhh := NULL]
sensor[, hhmmss := NULL]
ggplot(sensor[dateTime > "2015-10-09" & dateTime <= "2015-10-10"],
       aes(x = dateTime, y = FS261/mean(FS261))) + geom_line() + 
  geom_line(aes(x = datetime, y = var/mean(var)), data=imageSummary, col = "red")
#ggplot(sensor[dateTime > "2015-10-09" & dateTime <= "2015-10-10"], aes(x = dateTime, y = FS261)) + geom_line()

PointAnalyser(filenames[60])
```

## Outlook
Is it promising to search for a horizontal window, with the maximum contrast and use this only this window to determine fog? In this way areas with only sky or grass could be neglected.

```{r, fig.show='hold'}
im <- load.image(filenames[1])
mean(im)
var(im)

filenames[1] %>% ExtractBasicImageStatistics()
```

